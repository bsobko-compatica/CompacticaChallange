<div class="card">
    <div class="card-head">
        <div class="title">Parcels</div>

        <div class="controls">
            <div class="seg" title="Filter by status">
                <label><input type="checkbox" [(ngModel)]="showOK" (change)="applyFilters()"> <span class="badge ok">OK</span></label>
                <label><input type="checkbox" [(ngModel)]="showWatch" (change)="applyFilters()"> <span class="badge watch">Watch</span></label>
                <label><input type="checkbox" [(ngModel)]="showAction" (change)="applyFilters()"> <span class="badge action">Action</span></label>
            </div>

            <input class="search" type="search" [(ngModel)]="q" (input)="applyFilters()" placeholder="Search by parcel idâ€¦">
            <button class="btn" (click)="exportPdf()">Export to PDF</button>
        </div>
    </div>

    <div class="summary" style="padding:10px 14px;border-bottom:1px solid #eef0f2;">
        <span class="pill"><span class="badge ok">OK</span> {{countBy('OK')}}</span>
        <span class="pill"><span class="badge watch">Watch</span> {{countBy('Watch')}}</span>
        <span class="pill"><span class="badge action">Action</span> {{countBy('Action')}}</span>
    </div>

    <div class="table-wrap">
        <table class="tbl">
            <thead>
                <tr>
                    <th>ParcelId</th>
                    <th>Passes</th>
                    <th>Last pass</th>
                    <th>Duration</th>
                    <th>Status</th>
                    <th>Action</th>
                </tr>
            </thead>

            <tbody>
                <tr *ngFor="let r of filtered">
                    <td class="mono">{{ r.parcelId }}</td>
                    <td class="mono">{{ r.passCount }}</td>
                    <td class="mono">{{ fmtDate(r.lastPass) }}</td>
                    <td class="mono">{{ duration(r) }}</td>
                    <td><span class="badge" [ngClass]="badgeClass(status(r))">{{ status(r) }}</span></td>
                    <td class="nowrap">{{ actionText(status(r)) }}</td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="legend">
        <span class="legend-item"><span class="dot ok"></span> OK</span>
        <span class="legend-item"><span class="dot watch"></span> Watch</span>
        <span class="legend-item"><span class="dot action"></span> Action required</span>
    </div>
</div>
